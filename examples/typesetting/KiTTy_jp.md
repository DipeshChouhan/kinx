% KiTTy
% Kray-G, Mr.Diamond Global Blue Publisher
% September 18, 2020

Small and Easy, but Beautiful Design For You

<param style="JBookA4"/>
<param multibytefont="jp"/>
<param titleSize="78.8"/>
<param subtitleSize="14.4"/>
<param backgroundImage="back.jpg"/>

<toc with="lof,lot"/>

# イントロダクション

## KiTTy とは

**KiTTy** は **Ki**nx **T**iny **Ty**pesetting を意味し、
Kinx で実装された簡易組版システムの名称です。
Markdown 形式からの簡易トランスレーターを実装しているため、
Markdown 形式で書かれたドキュメントを美しく組版することができます。
本文書自体も Markdown で記載されているものを自動組版した一つの事例です。

考え方は \\LaTeX に近く、
テキスト形式で管理している文書ファイルを美しく組版することを目的としています。
より具体的には、本システムは \\LaTeX を置き換えることを目的とはしていませんが、
以下を実現することによって、
より個人的な利用シーンの中で、より簡単に利用できるようにすることを目的としています。

*   小さなシステムを維持すること
*   それなりに美しく組版できること
*   直接 PDF ファイルを出力できること

KiTTy は小さなシステムながらある程度美しく組版できる機能を持ち、
Markdown で書かれた文書から直接 PDF ファイルとして出力することができる組版システムです。

### Versus \\LaTeX

\\LaTeX は巨大なシステムです。
拡張性にも優れ、多くの人々に支えられた美しい文書を作成するための組版システムです。
KiTTy も \\LaTeX と同じ目的を持つ組版システムですが、
限られた機能しか提供しない代わりに小さなシステムとして提供されます。

\\LaTeX の巨大さは、インストールの複雑さにもつながります。
\\TeX、\\LaTeX では様々な機能を提供するためにディストリビューションそのものが複数存在しています。
それにより、ユーザーはまずどのディストリビューションを使うべきかで悩むことになります。
KiTTy は、Kinx パッケージに標準で組み込まれており、
Kinx をインストールすることですぐに使えるようになります。

ただし、小さく、そして簡単に使える代わりにトレードオフとして限られた機能[^1]しか提供されないといった欠点があります。
また、組版スピードは**非常に遅い**です。
パフォーマンスの改善は 1 つの課題ですが、小さなプロジェクトで個人的に利用することにフォーカスしています。

[^1]: 「限られた機能」に関しては、「\\nameref{機能概要}」を参照してください。

### Versus Word

WYSIWYG[^2] のワードプロセッサとして代表的な Word ですが、考え方が異なります。
WYSIWYG では見たままの形式で編集可能ですが、通常バイナリ形式で保存されます。
そのため、中に何が書かれているか知るには一般的に専用のソフトウェア（この場合 Word）が必要となります。
KiTTy は \\LaTeX 同様、テキストエディタさえあれば内容を知ることができ、編集することも可能です。

[^2]: **W**hat **Y**ou **S**ee **I**s **W**hat **Y**ou **G**et の頭文字をとったもの。見たままのものを実際に作成出力するという意味。

テキストで保存されるということは、別のソフトウェアで処理することも簡単であり、
Git のようなバージョン管理システム上で差分を確認することも容易です。
このことは特に、差分管理をバージョン管理システム上で実現したい場合には必須となる特徴です。

また、文書構造に関しても、
Word では直接その見た目から「構造化されたもの」か「見た目だけ整っているのか」の区別がつきません。
例えば、章番号がきちんと設定され、
文章の配置やレイアウトを変更した際に正しく番号を付け直してくれるかなど判別しづらいといった欠点もあります。
特に、書き方に関わらず「見た目として正しく見えてしまっている」ということにより、
他者の作成したファイルでは正しく設定されていなかった、といった不運もたびたび見られます。

KiTTy では、文書構造をテキストで表現する関係上、
章やセクション、図、表などのリファレンスを常に正しく把握し、
適切な番号付け、および相互参照機能を実現することができます。

その代わり、WYSIWYG のようにその場で出力後の体裁（見た目）を確認することができない、
といった欠点があります。

### Versus Vivliostyle

CSS 組版は Web 技術に基づいています。
CSS 組版は今現在最も将来性のある取り組みでしょう。
したがって、本格的に取り組むには CSS 組版がおすすめです。
その中でも Vivliostyle[^vivliostyle] は非常に有望なプロジェクトです。

[^vivliostyle]: https://vivliostyle.org/

KiTTy ではやはり「小さなシステム」という部分に価値を置いています。
手軽に扱えることが重要です。
時間が解決することではありますが、
CSS 組版は現時点で標準化の推進と並行して活動が行われています。
したがって仕様が未確定な部分も多く、今後仕様変更なども多く行われることが予想されます。
また、大規模に標準化等を進めていますので、
商用にも耐えうるシステムとなる一方でシステム自体は巨大になるでしょう。

KiTTy は小さく手軽に扱えることを一番のポイントとしています。

### 結論

現時点で本格的な組版を利用したい場合は \\LaTeX を使いましょう。
将来にわたって本格的な組版技術を学び、活用していきたい場合は Vivliostyle などの CSS 組版を学びましょう。
その上で、要約すると以下のケースにおいて KiTTy は有益でしょう。

*   \\TeX のような巨大なシステムではなく、小さな組版システムで簡単に利用したい
*   Git のようなバージョン管理システムを使った差分管理をしたい
*   文書構造を常に適切に把握し、相互参照などを正確に実施したい
*   サポートされている機能で十分であり、組版スピードも我慢できる

ちょっとした文書作成のために \\TeX をフルセットで使うには巨大すぎる、と感じている方で、
テキストで文書管理をしたい、と考えている方[^3]のために本システムを作成しました。
特に、Git で差分を含めた文書管理を行いたい場合、
WYSIWYG で実現されているワープロソフトでの管理は大変困難です。
主に、ワープロソフトでは管理したくないけれど高機能な組版ソフトは大がかりすぎる、
といった利用シーンを想定しています。

[^3]: つまり、私のような方。実際、当初の目的は自分のプロジェクトの簡易マニュアル作成のためでした。

## サポート機能

### 組版機能

KiTTy は組版機能として、以下の機能をサポートしています。
なお、カーニングは現在サポートしていません。

*   ハイフネーション・ジャスティフィケーション・行分割
*   ウィドウ／オーファン
*   箇条書き
*   数式
*   イメージ
*   グラフ（チャート）
*   テーブル
*   フォント
*   色
*   合字・特殊文字
*   プログラム・コード
*   タイトル・カバーページ・目次
*   見出し
*   相互参照
*   引用
*   脚注

### 日本語用組版機能

基本的な組版機能に加え、以下の日本語特有の処理が組み込まれています。
日本語以外の言語への拡張は私自身に知見が乏しく言語ごとの固有の拡張ポイントを意識していないため、
大幅な修正、もしくは機能追加が必要かもしれません。
ただし、ソースコードは公開されているので必要に応じて拡張することは可能でしょう。

*   日本語禁則処理
*   日本語ルビ

### PDF 機能

印刷した際には表面に現れてきませんが、
以下の機能を PDF 機能としてサポートしています。

*   外部リンク
*   相互参照リンク
*   しおり

# さあ始めよう

## インストール

インストールは以下の 2 ステップを実施します。

1. Kinx のインストール
2. KiTTy 追加モジュールのインストール

## ビルド

通常、ビルドから実施する必要はありません。
既にインストーラが提供されており、手順にしたがってインストールを実施することで本システムを利用することができます。
あえてビルドから実行したい、といった場合は以下の手順によってビルドを実施できます。

## hello, world

次の文書を作成し、`helloworld.md` ファイルとして保存します。

```markdown:lineNumber=false
hello, world
```

# 機能概要

## 組版機能

### ハイフネーション・ジャスティフィケーション・行分割

![float=right,scale=0.5,caption=ハイフネーション・両端揃え,label=image1](linebreak.png)

Franklin M. Liang のアルゴリズムに基づくハイフネーションをサポートしています。
また、ハイフネーションに伴うジャスティフィケーション（両端揃え）機能をサポートしています。

行分割は Knuth-Plass Line Breaking アルゴリズムを採用しています。
本アルゴリズムは、Box、Glue、Penalty によって分割位置をコントロールするアルゴリズムであり、
\\TeX で実装されているアルゴリズムと同様です。
これらハイフネーション・アルゴリズムも行分割アルゴリズムも、
今のところ組版システムでは最良の方法として知られている方法です。
ただし、実装自体は Kinx で改めて行われているため、
必ずしも出力結果は \\TeX での出力と同一にはならない場合があります。

### ウィドウ／オーファン

ウィドウ、およびオーファンに対するペナルティ処理を一部ですが実施します。
全てのケースで有効ではありませんのでご注意ください。
具体的には以下のケースで有効です。

*   セクション名がページの最後に取り残されるケースを抑止。
    *   この場合、セクション名ごと次のページに追い出されます。
*   複数行パラグラフにおいて、最後の行のみ次のページに送られるケースを抑止。
    *   この場合、最後の 2 行分が次のページに追い出されます。
*   複数行パラグラフにおいて、最初の行のみ前のページに残るケースを抑止。
    *   この場合、全ての行が次のページに追い出されます。
    *   この処理の結果としてセクションが残る場合、セクション自体も次のページに追い出されます。

これらの処理は自動的に行われます。
特に文書内に指示を記載する必要はありません。
ただし、全てのケースで正しく動作をする訳ではありませんので、
うまくレイアウトされない場合は必要に応じて `<pagebreak/>` コマンドを使って改ページを行ってください。

<pagebreak/>

### 箇条書き

箇条書きは記号によるものと番号付きのものが利用できます。
次の例は記号による箇条書きの例です。

```
*   レベル1
    *   レベル2
        *   レベル3
            *   レベル4
```

これは以下のように整形されます。

*   レベル1
    *   レベル2
        *   レベル3
            *   レベル4

次の例は番号付き箇条書きの例です。
数値ラベルは自動的に補正されます。

```
1.  レベル1
    1.  レベル2
        1.  レベル3
            1.  レベル4
            1.  レベル4
```

これは以下のように整形されます。

1.  レベル1
    1.  レベル2
        1.  レベル3
            1.  レベル4
            1.  レベル4

また、両者を混在させることも可能です。
次の例は混在させた場合の箇条書きの例です。

```
*   レベル1
    1.  レベル2
        *   レベル3
            1.  レベル4
```

これは以下のように整形されます。

*   レベル1
    1.  レベル2
        *   レベル3
            1.  レベル4

### 数式

KiTTy は \\KaTeX を内蔵しており、数式を表現することも可能です。
数式はスタンドアロン形式とインライン形式の 2 つの表現方法があります。

#### スタンドアロン形式

スタンドアロン形式はコードブロックの形式で記載し、1 行で表現されます。
その際、言語として `math` を指定します。

    ```math:label=Math1
    \begin{aligned}
        \int_{-\infty}^{\infty} f(x) dx &= \sqrt{\pi}
    \end{aligned}
    ```

上記のように記載すると、以下のように表現されます。
`label` オプションは付けなくても問題ありませんが、
ラベルを付けておくことで数式 \\ref{Math1} のように数式への参照を行うことが可能です。

```math:label=Math1
\begin{aligned}
    \int_{-\infty}^{\infty} f(x) dx &= \sqrt{\pi}
\end{aligned}
```

ただし、\\KaTeX はラベル機能を持っていないため、ラベル機能は KiTTy によって実現されています。
したがって、2 つの式を表現する場合にはラベルを自分自身でコントロールする必要があります。

    ```math:label=Math2(0.2)/Math3(0.6)
    \begin{aligned}
        E &= mc^2 \\
        m &= \frac{m_0}{\sqrt{1-\frac{v^2}{c^2}}} \\
    \end{aligned}
    ```

上記のようにすることで、ラベルの配置位置を数式の上端からそれぞれ 20%、60% の位置に Math2、Math3 のラベルを配置します。

```math:label=Math2(0.2)/Math3(0.6)
\begin{aligned}
    E &= mc^2 \\
    m &= \frac{m_0}{\sqrt{1-\frac{v^2}{c^2}}} \\
\end{aligned}
```

これによって、`\ref{Math2}` と記載することで数式 \\ref{Math2} への参照を、
`\ref{Math3}` と記載することで数式 \\ref{Math3} への参照を作成することが可能となります。

#### インライン形式

インラインで数式を扱う場合は `$` で囲みます。
例えば、`$E = mc^2$` と記載すると、$E = mc^2$ と表現されます。
また、インテグラルなどの高さのある表記をインラインで記載すると、
例えば \\ref{Math1} と同じ `$\\int\_{-\\infty}^{\\infty} f(x) dx = \\sqrt{\\pi}$` を記載すると、
$\\int\_{-\\infty}^{\\infty} f(x) dx = \\sqrt{\\pi}$ と表現されます。
なお、`$` で括った中では　Markdown の記法と重なるため、
`\` や `_` を `\` でエスケープする必要があることにご注意ください。

仮に大きな形式で表現したい場合は `\\displaystyle` を先頭につけて記載します。
例えば、`$\\displaystyle\\int\_{-\\infty}^{\\infty} f(x) dx = \\sqrt{\\pi}$` と `\\displaystyle` を付けて記載すると、
$\\displaystyle\\int\_{-\\infty}^{\\infty} f(x) dx = \\sqrt{\\pi}$ と表現されます。
ただし、行の高さが揃わないためあまりお勧めするものではありません。

### イメージ

イメージは Markdown のイメージ形式で記載しますが、
`alt` 部分にオプションを指定し、`![options](path)` の形で記載します。
スタンドアロン形式での挿入、インラインでの図の挿入、およびテキストを周りに配置する形でのフローティング形式で挿入することが可能です。

#### スタンドアロン・イメージ

全幅で表示させるには前後を空行の形にし、独立したパラグラフで記載します。

```:lineNumber=false
![scale=0.6](kinxlogo.png)
```

上記のように記載すると以下のように図が挿入されます。
`scale=0.6` の指定により版面の横幅の 60% の大きさに補正されて表示されます。
また、縦横の比率は維持されます。

![scale=0.6](kinxlogo.png)

#### インライン・イメージ

インラインの例です。
インラインで図を挿入する場合、
文中に直接以下のように書きます。

```:lineNumber=false
ファイルアイコンは ![scale=0.08,offsetY=-5.0](zip256.png) になります。
```

この場合、「ファイルアイコンは ![scale=0.08,offsetY=-5.0](zip256.png) になります。」と表現されます。
図の元のサイズに応じて `scale` と `offsetY` を適宜調整してください。

#### フローティング・イメージ

イメージをフローティングさせるには、オプションに `float=left` または `float=right` を指定します。
p.\\pageref{image1} に示す「\\nameref{image1}」の図はフローティング・イメージの一例です。

![float=left,caption=イトトンボ,scale=0.5](damselfly.jpg)

左の図は Public Domain で配布されている図[^4]です。
このような形でイメージをフローティングさせることができます。
フローティング形式でも版面の横幅に対するスケールとして `scale` の指定が可能ですが、
版面の横幅の最大 70% までに補正（制限）されます[^5]。

[^4]: https://free-images.com/
[^5]: この 70% にはイメージとテキストの間の余白を含みます。

また、このようにフローティングされている間に段落を分けることも可能です。
同じようにテキスト処理され、
最終的にフローティングされたイメージの下までパラグラフの文章が到達した場合、
自動的にテキスト幅が版面の幅に戻り、
自然な形でテキストが配置されます。

![float=right,caption=F14 Tomcats](f14_tomcats.jpg)

また、右のイメージのようにパラグラフの右側に配置することも可能です。
イメージは上記と同様 Public Domain のものを使わせていただいています。

1 つ注意点としては、
パラグラフの先頭とイメージの上端の位置を合わせる必要があることです。
パラグラフの途中にフローティングさせることはできません。
あるパラグラフを開始する際にフローティングすべきイメージがあれば、
パラグラフの左右どちらか指定した場所にイメージを配置します。

#### オプション

オプションは以下のものを使用できます。

<context label="Table:ImageOptions"/>
<context caption="イメージ・オプション"/>

| オプション |       値        |             意味             |
| ---------- | --------------- | ---------------------------- |
| `float`    | `left`, `right` | フローティング位置           |
| `scale`    | 0.0 ～ 1.0      | 実数、版面の幅に対する拡大率 |
| `caption`  | キャプション    | 図のキャプション             |

### グラフ（チャート）

グラフ（チャート）も挿入可能です。
グラフもスタンドアロン形式とフローティング形式の両形式をサポートしています。

#### スタンドアロン・グラフ

スタンドアロンでグラフを表示するには、コードブロックで `chart` を指定します。
例えば以下のように JSON データで記載します。
`width` や `height` などのグラフの情報に加え、
Chart.js[^ChartJs] のデータそのものを `options` フィールドに記載します。

[^ChartJs]: https://www.chartjs.org/

    ```chart
    {
        width: 800,
        height: 400,
        fontSize: 16,
        scale: 1.0,
        caption: "Radar Chart Example",
        options: {
            type: "radar",
            data: {
                labels: [["Eating", "Dinner"], ["Drinking", "Water"],
                    "Sleeping", ["Designing", "Graphics"],
                    "Coding", "Cycling", "Running"],
                datasets: [{
                    label: "My First dataset",
                    backgroundColor: "rgba(255, 0, 0, 0.2)",
                    borderColor: "red",
                    pointBackgroundColor: "red",
                    data: [ 10.1, 80.0, 72.2, 73.3, 55.0, 68.5, 92.0 ]
                }, {
                    label: "My Second dataset",
                    backgroundColor: "rgba(0, 0, 255, 0.2)",
                    borderColor: "blue",
                    pointBackgroundColor: "blue",
                    data: [ 30.9, 77.1, 49.9, 50.0, 67.8, 71.0, 22.8 ]
                }]
            },
            options: {
                legend: {
                    position: "top",
                },
                scale: {
                    ticks: {
                        beginAtZero: true
                    }
                }
            }
        }
    }
    ```

これは図 \\ref{Fig:RadarExample} のように出力されます。

```chart
{
    width: 800,
    height: 400,
    fontSize: 16,
    scale: 1.0,
    label: "Fig:RadarExample",
    caption: "Radar Chart Example",
    options: {
        type: "radar",
        data: {
            labels: [["Eating", "Dinner"], ["Drinking", "Water"],
                "Sleeping", ["Designing", "Graphics"],
                "Coding", "Cycling", "Running"],
            datasets: [{
                label: "My First dataset",
                backgroundColor: "rgba(255, 0, 0, 0.2)",
                borderColor: "red",
                pointBackgroundColor: "red",
                data: [ 10.1, 80.0, 72.2, 73.3, 55.0, 68.5, 92.0 ]
            }, {
                label: "My Second dataset",
                backgroundColor: "rgba(0, 0, 255, 0.2)",
                borderColor: "blue",
                pointBackgroundColor: "blue",
                data: [ 30.9, 77.1, 49.9, 50.0, 67.8, 71.0, 22.8 ]
            }]
        },
        options: {
            legend: {
                position: "top",
            },
            scale: {
                ticks: {
                    beginAtZero: true
                }
            }
        }
    }
}
```

#### フローティング・グラフ

グラフはイメージの配置と同様、テキストの中にフローティングさせることも可能です。

```chart
{
    float: { right: true },
    width: 480,
    height: 300,
    scale: 0.4,
    caption: "Line Chart Example",
    options: {
        type: "line",
        data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
            datasets:[{
                lineTension: 0,
                label: "Line A",
                data: [ 10.9, 32.8, 44.1, 56.9, 78.3, 64.2, 91.2],
                backgroundColor: "rgba(0, 0, 255, 0.2)",
                borderColor: "rgb(0, 0, 255)",
                borderWidth: 1
            }]
        },
        options: {
            legend: {
                labels: {
                    fontColor: "#0000ff"
                }
            }
        }
    }
}
```

オプションで `float: { right: true }` といった形で指定すると、
その後に続くパラグラフに対してフローティングさせることができます。

ここでは折れ線グラフを記載しています。
`scale` はイメージと同様、
版面の横幅に対するスケールを表します。
スタンドアロン形式、フローティング形式いずれの場合でも、
グラフにもキャプションを付けることが可能で、
図として挿入されます。
目次を出力する場合、
図目次にも反映されます。
また、イメージをフローティング形式で配置させた場合と同様に、
パラグラフはグラフの下側に自然な形で自動的に取り囲むように配置されます。

上記は以下のように記載されます。
なお、ここでは紙面の都合上、省略しますが、`options` は Chart.js のオプションです。

    ```chart
    {
        float: { right: true },
        width: 480, height: 300, scale: 0.4, caption: "Line Chart Example",
        options: {
            type: "line",
            ...(省略)
        }
    }
    ```

### テーブル

#### Markdown テーブル

テーブルもサポートします。
通常の Markdown の形式で表を記載することにより、
自動的にテーブル出力します。

例えば、先ほどの「\\nameref{Table:ImageOptions}」のテーブルは次のように記載しています。
直接 Markdown の表形式で表現できないオプションは、`<context />` タグで指定します。

    <context label="Table:ImageOptions"/>
    <context caption="イメージ・オプション"/>
    | オプション |       値        |             意味             |
    | ---------- | --------------- | ---------------------------- |
    | `float`    | `left`, `right` | フローティング位置           |
    | `scale`    | 0.0 ～ 1.0      | 実数、版面の幅に対する拡大率 |
    | `caption`  | キャプション    | 図のキャプション             |

通常の Markdown テーブルのように記載することで、
右寄せ、中寄せ等も可能です。
また、数式を含めることも可能です。
セルの内容が長くなりすぎる場合、
`<context cell-i-j="..." />` の形で `<context />` タグに追い出すことも可能です。
この時、$(i, j)$ は Body 部分（ヘッダは含まない）の左上を $(0, 0)$ として記載します。

    <context label="Table:TableExample"/>
    <context caption="テーブル記述の例"/>
    <context vline-left="single"/>
    <context vline-right="single"/>
    <context vline-inside="single"/>
    <context hline-header="double"/>
    <context hline-inside="single"/>
    <context cell-2-1="$\displaystyle\int_{-\infty}^{\infty} f(x) dx = \sqrt{\pi}$"/>
    | 左寄せ |         中寄せ         |        右寄せ         |
    | :----- | :--------------------: | --------------------: |
    | A1     | Aligned to the center. | Aligned to the right. |
    | A2     |  Cell $(1,1)$          |      Cell $(1,2)$     |
    | A3     |           -            |      Cell $(2,2)$     |

上記は以下のように出力されます。

<context label="Table:TableExample"/>
<context caption="テーブル記述の例"/>
<context vline-left="single"/>
<context vline-right="single"/>
<context vline-inside="single"/>
<context hline-header="double"/>
<context hline-inside="single"/>
<context cell-2-1="$\displaystyle\int_{-\infty}^{\infty} f(x) dx = \sqrt{\pi}$"/>

| 左寄せ |         中寄せ         |        右寄せ         |
| :----- | :--------------------: | --------------------: |
| A1     | Aligned to the center. | Aligned to the right. |
| A2     |  Cell $(1,1)$          |      Cell $(1,2)$     |
| A3     |           -            |      Cell $(2,2)$     |

#### オプション

Markdown テーブル表記で表現できなかったパラメータは、`<context />` タグで指定します。
指定できる項目の一覧を「\\nameref{Table:TableOptions}」に示します。
これらの値は一時的に利用され、参照された後自動的に削除されます。
したがって、複数のテーブルで共有して使用できませんので、
テーブルごとに設定します。

ただし、`label`、`caption` 以外はデフォルト値を変更できます。
その場合、項目名に `-default` を指定して設定してください。
例えば、`vline-left-default` とします。

<context label="Table:TableOptions"/>
<context caption="テーブル・オプション"/>
<context limit-column="0"/>

|   オプション   |             値              |                                                 意味                                                 |
| -------------- | --------------------------- | ---------------------------------------------------------------------------------------------------- |
| `label`        | 相互参照ラベル              | 相互参照で指定するラベルを設定する。                                                                 |
| `caption`      | キャプション                | 表のキャプション。                                                                                   |
| `vline-left`   | `single`, `double`, `false` | 表の左側に縦罫線を出力するかの指定をする（デフォルト `false`）。                                     |
| `vline-right`  | 同上                        | 表の右側に縦罫線を出力するかの指定をする（デフォルト `false`）。                                     |
| `vline-inside` | 同上                        | 表中に縦罫線を出力するかの指定をする（デフォルト `false`）。                                         |
| `hline-top`    | 同上                        | 表の上側に横罫線を出力するかの指定をする（デフォルト `single`）。                                    |
| `hline-bottom` | 同上                        | 表の下側に横罫線を出力するかの指定をする（デフォルト `single`）。                                    |
| `hline-header` | 同上                        | 表のヘッダ行の下側に横罫線を出力するかの指定をする（デフォルト `single`）。                          |
| `hline-inside` | 同上                        | 表中に横罫線を出力するかの指定をする（デフォルト `false`）。                                         |
| `cell-i-j`     | テキスト                    | セル内容を別定義する。`i`、`j` はセル位置で、`i` が行、`j` が列を示す。それぞれ 0 始まりで指定する。 |
| `limit-column` | 整数                        | セルサイズの最小幅を指定された列が折り返さない幅とする。                                             |
| `limit-width`  | 実数                        | セルサイズの最小幅を指定された値とする。                                                             |

### フォント

#### ボールド、イタリック、ボールドイタリック

**Bold**、*Italic*、***BoldItalic*** は通常の Markdown と同様に記述できます。
以下のように記述します。
なお、日本語にイタリック体はありませんのでご注意ください。

<context label="Table:FontShape"/>
<context caption="ボールド、イタリック、ボールドイタリックの書き方"/>

|      Markdown      |       出力       |                 意味                 |
| ------------------ | ---------------- | ------------------------------------ |
| `**Bold**`         | **Bold**         | ボールド体で表現する。               |
| `*Italic*`         | *Italic*         | イタリック体で表現する。             |
| `***BoldItalic***` | ***BoldItalic*** | ボールドかつイタリック体で表現する。 |

#### フォントの利用

デフォルトで用意されていないフォント・ファイルは明示的にロードして利用します。
ロードの仕方は以下の通りです。
カンマ区切りで以下の 4 つのパラメータを指定します。

```
<font-load info="Name,type,shape,FileName.ttf" />
```

1 度ロードすれば、それ以降の文章中に `Name` を使用して自由に利用できます。
各パラメータの意味は以下の通りです。

* `Name` は識別子として任意の名前を付けられます。
* `type` はフォントのタイプを表し、`serif`、`sans`、`monotype` の中から選択します。
* `shape` はフォントの形を表し、`regular`、`bold`、`italic`、`bolditalic` の中から選択します。
    * `regular` は通常の文章で使用されます。
    * `bold`、`italic`、`bolditalic` はそれぞれボールド、イタリック、ボールドイタリックに対応します。

利用する場合は、以下の例のように `\font` コマンドで指定して利用します。
なお、コマンド名と ''`[`'' および ''`]`'' をエスケープする必要がありますのでご注意ください。
以下の例は `Parisienne-Regular.ttf` フォント[^FontLoad]を利用して出力する例です。

[^FontLoad]: KiTTy のパッケージに含まれてはいますが、デフォルトでロードされません。
このように明示的にロードして利用します。

```
<font-load info="Parisienne,serif,regular,Parisienne-Regular.ttf" />
Changing the font is available only with a scope like
''\\font\[name=Parisienne\]{This is a pen.},''
and the font will be restored here.
```

これは、「<font-load info="Parisienne,serif,regular,Parisienne-Regular.ttf" />
Changing the font is available only with a scope like
''\\font\[name=Parisienne\]{This is a pen.},''
and the font will be restored here.」
となります。

上記例の通り、`\font` コマンドで囲まれたスコープ内でのみ有効です。

#### フォント・サイズ（直接指定）

フォント・サイズは `\font` コマンドの `size` パラメータを指定します。

```
「この後フォントが 7pt に \\font\[size=7pt\]{縮小} します。
また、この後フォントが 15pt に \\font\[size=15pt\]{拡大} します。」
と表現されます。
また、例えば `\font[size=1.2em]{サイズ 1.2 倍}` と記載すると、
\\font\[size=1.2em\]{サイズ 1.2 倍} と表現されます。
```

「この後フォントが 7pt に \\font\[size=7pt\]{縮小} します。
また、この後フォントが 15pt に \\font\[size=15pt\]{拡大} します。」
と表現されます。
また、例えば `\font[size=1.2em]{サイズ 1.2 倍}` と記載すると、
\\font\[size=1.2em\]{サイズ 1.2 倍} と表現されます。

サイズは上記の例の通り単位を指定することができます。
指定できる単位は以下の通りです。

<context label="Table:FontSizeUnit"/>
<context caption="フォントサイズに指定可能な単位一覧"/>

| 単位 |                               意味                               |
| ---- | ---------------------------------------------------------------- |
| `em` | 現在のフォントサイズを基準（1.0）とした相対サイズで指定します。  |
| `ex` | 現在のフォントの小文字の高さを基準とした相対サイズで指定します。 |
| `px` | サイズをピクセルで指定します。                                   |
| `pt` | サイズをポイントで指定します。                                   |
| `pc` | サイズをパイカ（1pc = 1/6インチ）で指定します。                  |
| `mm` | サイズをミリメートルで指定します。                               |
| `cm` | サイズをセンチメートルで指定します。                             |
| `in` | サイズをインチで指定します。                                     |

#### フォント・サイズ（相対指定）

相対的に指定するには `\bigger`、`\smaller` を使います。
それぞれ、指定したスコープ内のフォントサイズが +1 または -1 されます。
単位はポイント（pt）です。

```
次の文章は `\bigger` の例です。
\\bigger{これが「\\bigger{これが「\\bigger{これが「文章」です}」です}」です}、
となります。
また、`\smaller` は、
\\smaller{これが「\\smaller{これが「\\smaller{これが「文章」です}」です}」です}、
となります。
```

以下のように表現されます。

> 次の文章は `\bigger` の例です。
> \\bigger{これが「\\bigger{これが「\\bigger{これが「文章」です}」です}」です}、
> となります。
> また、`\smaller` は、
> \\smaller{これが「\\smaller{これが「\\smaller{これが「文章」です}」です}」です}、
> となります。

### 色

#### 文字色

文字の色を変えるには `\color` コマンドを使用します。
以下にサンプルを示します。

```
*   \\color\[red\]{\\bold{Red}.
    This line should be colored by the name of `red`.}
*   \\color\[green\]{\\bold{Green}.
    This line should be colored by the name of `green`.}
*   \\color\[blue\]{\\bold{Blue}.
    This line should be colored by the name of `blue`.}
*   \\color\[cyan1\]{\\bold{Cyan}.
    This line should be colored by the name of `cyan1`.}
*   \\color\[magenta1\]{\\bold{Magenta}.
    This line should be colored by the name of `magenta1`.}
*   \\color\[yellow\]{\\bold{Yellow}.
    This line should be colored by the name of `yellow`.}
*   \\color\[R=0,G=64,B=255\]{\\bold{RGB}.
    This line should be colored by RGB value of `RGB=0,64,255`.}
*   \\color\[C=0.5,M=0.8,Y=0.2,K=0.0\]{\\bold{CMYK}.
    This line should be colored by CMYK value of `CMYK=0.5,0.8,0.2,0.0`.}
```

*   \\color\[red\]{\\bold{Red}.
    This line should be colored by the name of `red`.}
*   \\color\[green\]{\\bold{Green}.
    This line should be colored by the name of `green`.}
*   \\color\[blue\]{\\bold{Blue}.
    This line should be colored by the name of `blue`.}
*   \\color\[cyan1\]{\\bold{Cyan}.
    This line should be colored by the name of `cyan1`.}
*   \\color\[magenta1\]{\\bold{Magenta}.
    This line should be colored by the name of `magenta1`.}
*   \\color\[yellow\]{\\bold{Yellow}.
    This line should be colored by the name of `yellow`.}
*   \\color\[R=0,G=64,B=255\]{\\bold{RGB}.
    This line should be colored by RGB value of `RGB=0,64,255`.}
*   \\color\[C=0.5,M=0.8,Y=0.2,K=0.0\]{\\bold{CMYK}.
    This line should be colored by CMYK value of `CMYK=0.5,0.8,0.2,0.0`.}

サポートされる色の名称に関しては、「\\nameref{色名称一覧}」を参照してください。

### 合字・特殊文字

#### 合字

以下の 5 種類の合字のみサポートしています。

* f{}i ... fi
* f{}l ... fl
* f{}f ... ff
* f{}f{}i ... ffi
* f{}f{}l ... ffl

#### 特殊文字

特殊文字として '' と '' があります。
これはいずれも `''` と記載することで自動的に判別されます。

```
これは ''サンプル'' です。
```

上記は、「これは ''サンプル'' です。」となります。

### プログラム・コード

#### 記述方法

プログラムコードはブロック形式のコードブロックで記述します。
デフォルトでは行番号が付加され、影付きのボックスで表現されます。

    ```
    class Test {
        public test() {
            # Test Method.
        }
    }
    ```

上記のように記述すると以下のように出力されます[^ProgramCodeBox1]。

[^ProgramCodeBox1]: どちらも同じ形ですので分かりづらいですが、<monotype-backq3 /> のあるほうが記述例です。

```
class Test {
    public test() {
        # Test Method.
    }
}
```

行番号を外し、影を無くしてみましょう。
以下のように記述します。

    ```:lineNumber=false,box=BOX_NORMAL
    class Test {
        public test() {
            # Test Method.
        }
    }
    ```

すると、以下のように出力されます。

```:lineNumber=false,box=BOX_NORMAL
class Test {
    public test() {
        # Test Method.
    }
}
```

#### オプション

`lineNumber` オプションは `true` または `false` を指定します。
`box` オプションで指定可能な値は以下の通りです。

<context label="Table:CodeBoxOption"/>
<context caption="box オプションで指定できる値の一覧"/>
<context limit-column="0"/>

|      値      |                      意味                      |
| ------------ | ---------------------------------------------- |
| `BOX_NORMAL` | 通常の太さの線でボックスを表示する。           |
| `BOX_THIN`   | 細い線でボックスを表示する。                   |
| `BOX_THICK`  | 太い線でボックスを表示する。                   |
| `BOX_SHADOW` | 影付きの線でボックスを表示する。（デフォルト） |

### タイトル・カバーページ・目次

KiTTy は目次を自動的に作成します。
目次用の設定は最初のチャプターが現れる前までに設定します。
以下の例は本文書の例です。
以下のようにすることで、目次のタイトル、執筆者、日付を指定します。
順序は決まっているため、不要なものは `%` のみ記載します。
また、`%` での設定の後に出てきた最初のパラグラフをサブタイトルと認識します。

```
% KiTTy
% Kray-G, Mr.Diamond Global Blue Publisher
% September 18, 2020

Small and Easy, but Beautiful Design For You
```

その他の設定は、最初のチャプターが現れる前までに `<param />` タグで指定します。
以下が本文書での例です。

```
<param style="JBookA4"/>
<param multibytefont="jp"/>
<param titleSize="78.8"/>
<param subtitleSize="14.4"/>
<param backgroundImage="back.jpg"/>

<toc with="lof,lot"/>
```

以下の意味となります。

*   スタイルは `JBookA4` を使用する。
*   タイトルの文字サイズは 78.8pt とする。
*   サブタイトルの文字サイズは 14.4pt とする。
*   表紙の背景画像として `back.jpg` を使用する。
*   目次を表示する。その際、図目次（`lof`）、表目次（`lot`）も表示する[^loflot]。

[^loflot]: `lof` と `lot` は図目次・表目次（List Of Figures、List of Tables）を意味します。

### 見出し

章、節は Markdown の `#` で示します。
それぞれ以下のように解釈されます。

<context label="Table:ChapterSection"/>
<context caption="見出しの指定方法"/>
<context limit-column="0"/>

|  記号  |           内容            |
| ------ | ------------------------- |
| `#`    | 章（Chapter）             |
| `##`   | 節（Section）             |
| `###`  | 小節（Sub Section）       |
| `####` | 少々節（Sub Sub Section） |

これらの見出しには自動的に番号が付加され、相互参照（→\\nameref{相互参照}）が可能になります。
相互参照する場合はラベルとして見出し文字列を直接指定できます。

### 相互参照

相互参照をサポートしています。
相互参照は以下に対して行うことが可能です。

<context label="Table:CrssReference"/>
<context caption="相互参照コマンド一覧"/>
<context limit-column="0"/>

|     参照方法      |                内容                |
| ----------------- | ---------------------------------- |
| `\ref{label}`     | 章番号、節番号、図表番号、数式番号 |
| `\textref{label}` | それぞれのテキストの参照           |
| `\nameref{label}` | それぞれの「番号＋テキスト」の参照 |
| `\pageref{label}` | それぞれに対するページの参照       |

なお、参照が先に現れた場合、その時点で番号などが解決できません。
その場合は再度実行することで解決できるようになります。

### 引用

引用は以下の形式でサポートされます。
引用中に Markdown コマンド（→\\nameref{Markdown コマンド}）を使用することはできませんが、
KiTTy コマンド（→\\nameref{KiTTy コマンド}）を使用することはできます。
例えば、本書の冒頭の文章を引用してみましょう。
以下のように行頭に `>` を付けて記述します。

```
> **KiTTy** は **Ki**nx **T**iny **Ty**pesetting を意味し、
> Kinx で実装された簡易組版システムの名称です。
> Markdown 形式からの簡易トランスレーターを実装しているため、
> Markdown 形式で書かれたドキュメントを美しく組版することができます。
> 本文書自体も Markdown で記載されているものを自動組版した一つの事例です。
> 
> 考え方は \\LaTeX に近く、
> テキスト形式で管理している文書ファイルを美しく組版することを目的としています。
> より具体的には、本システムは \\LaTeX を置き換えることを目的とはしていませんが、
> 以下を実現することによって、
> より個人的な利用シーンの中で、より簡単に利用できるようにすることを目的としています。
```

以下のように引用されます。

> **KiTTy** は **Ki**nx **T**iny **Ty**pesetting を意味し、
> Kinx で実装された簡易組版システムの名称です。
> Markdown 形式からの簡易トランスレーターを実装しているため、
> Markdown 形式で書かれたドキュメントを美しく組版することができます。
> 本文書自体も Markdown で記載されているものを自動組版した一つの事例です。
> 
> 考え方は \\LaTeX に近く、
> テキスト形式で管理している文書ファイルを美しく組版することを目的としています。
> より具体的には、本システムは \\LaTeX を置き換えることを目的とはしていませんが、
> 以下を実現することによって、
> より個人的な利用シーンの中で、より簡単に利用できるようにすることを目的としています。

### 脚注

脚注もサポートします。
脚注は `[^label]` の形で参照し、独立したパラグラフの位置に `[^label]: ...` の形式で記述します。
例えば、以下の通りです。

```
この文章に脚注[^f1]を置きます。

[^f1]: これが脚注になります。
```

実際に記述すると、「この文章に脚注[^f1]を置きます。」となります。
本ページの最下部に脚注として表示されているはずです。

[^f1]: これが脚注になります。

<pagebreak/>

## 日本語用組版機能

### 日本語禁則処理

以下の日本語の禁則処理を実施します。

*   行頭禁則文字
*   行末禁則文字
*   グループルビの分離禁止

### 日本語ルビ

日本語のルビに対応しています。
以下の仕様です。

*   幅は親文字とルビのどちらか広いほうが採用されます。
*   モノルビ、グループルビの両方に対応してます。
*   親文字、ルビ、どちらにも和文、英文両方が使えます。

以下は芥川龍之介の「蜘蛛の糸」の一節です。
グループルビとしてルビを振る例です。

```
ある日の事でございます。\\ruby\[おしゃかさま\]{御釈迦様}は
極楽の\\ruby\[はすいけ\]{蓮池}のふちを、
独りでぶらぶら御歩きになっていらっしゃいました。
池の中に咲いている\\ruby\[はす\]{蓮}の花は、みんな玉のようにまっ白で、
そのまん中にある\\ruby\[きんいろ\]{金色}の\\ruby\[ずい\]{蕊}からは、
何とも云えない\\ruby\[よ\]{好}い\\ruby\[におい\]{匂}が、
\\ruby\[たえま\]{絶間}なくあたりへ\\ruby\[あふ\]{溢}れて居ります。
極楽は丁度朝なのでございましょう。

やがて御釈迦様はその池のふちに\\ruby\[おたたず\]{御佇}みになって、
水の\\ruby\[おもて\]{面}を\\ruby\[おお\]{蔽}っている蓮の葉の間から、
ふと下の\\ruby\[ようす\]{容子}を御覧になりました。
この極楽の蓮池の下は、
丁度\\ruby\[じごく\]{地獄}の底に当って居りますから、
\\ruby\[すいしよう\]{水晶}のような水を透き徹して、
\\ruby\[さんず\]{三途}の河や針の山の景色が、
丁度\\ruby\[のぞ\]{覗}き\\ruby\[めがね\]{眼鏡}を見るように、
はっきりと見えるのでございます。
```

これは以下のように出力されます。

> ある日の事でございます。\\ruby\[おしゃかさま\]{御釈迦様}は
> 極楽の\\ruby\[はすいけ\]{蓮池}のふちを、
> 独りでぶらぶら御歩きになっていらっしゃいました。
> 池の中に咲いている\\ruby\[はす\]{蓮}の花は、みんな玉のようにまっ白で、
> そのまん中にある\\ruby\[きんいろ\]{金色}の\\ruby\[ずい\]{蕊}からは、
> 何とも云えない\\ruby\[よ\]{好}い\\ruby\[におい\]{匂}が、
> \\ruby\[たえま\]{絶間}なくあたりへ\\ruby\[あふ\]{溢}れて居ります。
> 極楽は丁度朝なのでございましょう。
> 
> やがて御釈迦様はその池のふちに\\ruby\[おたたず\]{御佇}みになって、
> 水の\\ruby\[おもて\]{面}を\\ruby\[おお\]{蔽}っている蓮の葉の間から、
> ふと下の\\ruby\[ようす\]{容子}を御覧になりました。
> この極楽の蓮池の下は、
> 丁度\\ruby\[じごく\]{地獄}の底に当って居りますから、
> \\ruby\[すいしよう\]{水晶}のような水を透き徹して、
> \\ruby\[さんず\]{三途}の河や針の山の景色が、
> 丁度\\ruby\[のぞ\]{覗}き\\ruby\[めがね\]{眼鏡}を見るように、
> はっきりと見えるのでございます。

次に全てモノルビとしてルビを振った例です。
モノルビの場合、区切る場所に `|` を挿入します。

```
ある日の事でございます。\\ruby\[お|しゃ|か|さま\]{御釈迦様}は
極楽の\\ruby\[はす|いけ\]{蓮池}のふちを、
独りでぶらぶら御歩きになっていらっしゃいました。
池の中に咲いている\\ruby\[はす\]{蓮}の花は、みんな玉のようにまっ白で、
そのまん中にある\\ruby\[きん|いろ\]{金色}の\\ruby\[ずい\]{蕊}からは、
何とも云えない\\ruby\[よ\]{好}い\\ruby\[におい\]{匂}が、
\\ruby\[たえ|ま\]{絶間}なくあたりへ\\ruby\[あふ\]{溢}れて居ります。
極楽は丁度朝なのでございましょう。

やがて御釈迦様はその池のふちに\\ruby\[お|たたず\]{御佇}みになって、
水の\\ruby\[おもて\]{面}を\\ruby\[おお\]{蔽}っている蓮の葉の間から、
ふと下の\\ruby\[よう|す\]{容子}を御覧になりました。
この極楽の蓮池の下は、
丁度\\ruby\[じ|ごく\]{地獄}の底に当って居りますから、
\\ruby\[すい|しよう\]{水晶}のような水を透き徹して、
\\ruby\[さん|ず\]{三途}の河や針の山の景色が、
丁度\\ruby\[のぞ\]{覗}き\\ruby\[め|がね\]{眼鏡}を見るように、
はっきりと見えるのでございます。
```

このようになります。
いくつかの部分でルビの乗り方が先ほどと異なることが分かるでしょう。

> ある日の事でございます。\\ruby\[お|しゃ|か|さま\]{御釈迦様}は
> 極楽の\\ruby\[はす|いけ\]{蓮池}のふちを、
> 独りでぶらぶら御歩きになっていらっしゃいました。
> 池の中に咲いている\\ruby\[はす\]{蓮}の花は、みんな玉のようにまっ白で、
> そのまん中にある\\ruby\[きん|いろ\]{金色}の\\ruby\[ずい\]{蕊}からは、
> 何とも云えない\\ruby\[よ\]{好}い\\ruby\[におい\]{匂}が、
> \\ruby\[たえ|ま\]{絶間}なくあたりへ\\ruby\[あふ\]{溢}れて居ります。
> 極楽は丁度朝なのでございましょう。
> 
> やがて御釈迦様はその池のふちに\\ruby\[お|たたず\]{御佇}みになって、
> 水の\\ruby\[おもて\]{面}を\\ruby\[おお\]{蔽}っている蓮の葉の間から、
> ふと下の\\ruby\[よう|す\]{容子}を御覧になりました。
> 丁度\\ruby\[じ|ごく\]{地獄}の底に当って居りますから、
> \\ruby\[すい|しよう\]{水晶}のような水を透き徹して、
> \\ruby\[さん|ず\]{三途}の河や針の山の景色が、
> 丁度\\ruby\[のぞ\]{覗}き\\ruby\[め|がね\]{眼鏡}を見るように、
> はっきりと見えるのでございます。



## PDF 機能

### 外部リンク
### 相互参照リンク
### しおり

# コマンド

## Markdown コマンド

### サポート Markdown コマンド
### HTML コマンド

## KiTTy コマンド

### パラグラフ処理コマンド
### 単コマンド

# 機能拡張

## スタイル

### スタイルの追加
### カバーページ・スタイルの追加
### チャプター・スタイルの追加

## 禁則処理

### 禁則処理の追加

<appendix/>

# 色名称一覧

# 何か

